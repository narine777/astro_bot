"""
üöÄ AstroBot: –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏–∏ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏ –∑–∞–¥–∞—á
üéØ –°–æ–ª–Ω–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ + –∑–≤–µ–∑–¥—ã –¥–ª—è –æ–ª–∏–º–ø–∏–∞–¥
"""

import logging
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton
from telegram.ext import Application, CommandHandler, ContextTypes, CallbackQueryHandler, MessageHandler, filters

import threading
import requests
import time
import json
import re
import os

# ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –í–ê–® –¢–û–ö–ï–ù –ë–û–¢–ê - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô
TOKEN = "8591960754:AAGBlsOx7h28a-UQvSH_0L4u81VMYTsLaFQ"


# ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• ====================
class CelestialDatabase:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–µ–±–µ—Å–Ω—ã—Ö —Ç–µ–ª"""

    def __init__(self, json_file='celestial_data.json'):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

        Args:
            json_file (str): –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É —Å –¥–∞–Ω–Ω—ã–º–∏
        """
        self.json_file = json_file
        self.data = {}
        self.load_data()

    def load_data(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON —Ñ–∞–π–ª–∞"""
        try:
            if not os.path.exists(self.json_file):
                print(f"‚ùå –§–∞–π–ª {self.json_file} –Ω–µ –Ω–∞–π–¥–µ–Ω!")
                self.create_sample_data()
                return

            with open(self.json_file, 'r', encoding='utf-8') as f:
                self.data = json.load(f)

            print(f"‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–∞: {len(self.data)} –æ–±—ä–µ–∫—Ç–æ–≤")

        except json.JSONDecodeError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON: {e}")
            self.data = {}
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
            self.data = {}

    def create_sample_data(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"""
        print("üìù –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")

        self.data = {
            "–°–æ–ª–Ω—Ü–µ": {
                "emoji": "‚òÄÔ∏è",
                "name_en": "Sun",
                "type": "–ó–≤–µ–∑–¥–∞ (G2V)",
                "mass": "1.9885√ó10¬≥‚Å∞ –∫–≥",
                "radius": "6.957√ó10‚Å∏ –º",
                "distance": "1 –∞.–µ.",
                "period": "25.05 –¥–Ω–µ–π (—ç–∫–≤–∞—Ç–æ—Ä)",
                "luminosity": "3.828√ó10¬≤‚Å∂ –í—Ç (1 L‚òâ)",
                "temperature": "5772 K",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ —Å –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤)",
                "sources": "NASA, SOHO, SDO",
                "task": "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –°–æ–ª–Ω—Ü–∞",
                "solution": "L = 4œÄR¬≤œÉT‚Å¥ = 4√ó3.1416√ó(6.957√ó10‚Å∏)¬≤√ó5.67√ó10‚Åª‚Å∏√ó5772‚Å¥ ‚âà 3.828√ó10¬≤‚Å∂ –í—Ç"
            },
            "–ú–µ—Ä–∫—É—Ä–∏–π": {
                "emoji": "‚òø",
                "name_en": "Mercury",
                "type": "–ü–ª–∞–Ω–µ—Ç–∞ –∑–µ–º–Ω–æ–π –≥—Ä—É–ø–ø—ã",
                "mass": "3.3011√ó10¬≤¬≥ –∫–≥",
                "radius": "2.4397√ó10‚Å∂ –º",
                "distance": "0.3871 –∞.–µ.",
                "period": "87.97 –¥–Ω–µ–π",
                "temperature": "440 K (—Å—Ä–µ–¥–Ω.)",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ MESSENGER)",
                "sources": "NASA, MESSENGER",
                "task": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è",
                "solution": "g = GM/R¬≤ = 6.674√ó10‚Åª¬π¬π√ó3.301√ó10¬≤¬≥/(2.44√ó10‚Å∂)¬≤ ‚âà 3.70 –º/—Å¬≤"
            },
            "–í–µ–Ω–µ—Ä–∞": {
                "emoji": "‚ôÄ",
                "name_en": "Venus",
                "type": "–ü–ª–∞–Ω–µ—Ç–∞ –∑–µ–º–Ω–æ–π –≥—Ä—É–ø–ø—ã",
                "mass": "4.8675√ó10¬≤‚Å¥ –∫–≥",
                "radius": "6.0518√ó10‚Å∂ –º",
                "distance": "0.7233 –∞.–µ.",
                "period": "224.7 –¥–Ω–µ–π",
                "temperature": "737 K",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ Magellan)",
                "sources": "NASA, ESA, Magellan",
                "task": "–°—Ä–∞–≤–Ω–∏—Ç—å —Å –ó–µ–º–ª–µ–π –ø–æ –º–∞—Å—Å–µ",
                "solution": "M_–í–µ–Ω–µ—Ä—ã/M_–ó–µ–º–ª–∏ = 4.8675√ó10¬≤‚Å¥/5.9722√ó10¬≤‚Å¥ ‚âà 0.815"
            },
            "–ó–µ–º–ª—è": {
                "emoji": "üåç",
                "name_en": "Earth",
                "type": "–ü–ª–∞–Ω–µ—Ç–∞ –∑–µ–º–Ω–æ–π –≥—Ä—É–ø–ø—ã",
                "mass": "5.9722√ó10¬≤‚Å¥ –∫–≥",
                "radius": "6.371√ó10‚Å∂ –º",
                "distance": "1 –∞.–µ.",
                "period": "365.25 –¥–Ω–µ–π",
                "temperature": "288 K (—Å—Ä–µ–¥–Ω.)",
                "accuracy": "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è",
                "sources": "–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã",
                "task": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–æ—Å–º–∏—á–µ—Å–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å",
                "solution": "v‚ÇÅ = ‚àö(GM/R) = ‚àö(6.674√ó10‚Åª¬π¬π√ó5.972√ó10¬≤‚Å¥/6.371√ó10‚Å∂) ‚âà 7.91 –∫–º/—Å"
            },
            "–ú–∞—Ä—Å": {
                "emoji": "‚ôÇ",
                "name_en": "Mars",
                "type": "–ü–ª–∞–Ω–µ—Ç–∞ –∑–µ–º–Ω–æ–π –≥—Ä—É–ø–ø—ã",
                "mass": "6.4171√ó10¬≤¬≥ –∫–≥",
                "radius": "3.3895√ó10‚Å∂ –º",
                "distance": "1.5237 –∞.–µ.",
                "period": "686.98 –¥–Ω–µ–π",
                "temperature": "210 K (—Å—Ä–µ–¥–Ω.)",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ –æ—Ä–±–∏—Ç–∞–ª—å–Ω—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤)",
                "sources": "NASA, ESA, Mars Reconnaissance Orbiter",
                "task": "–ù–∞–π—Ç–∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –ú–∞—Ä—Å–∞",
                "solution": "œÅ = 3M/(4œÄR¬≥) = 3√ó6.417√ó10¬≤¬≥/(4√ó3.1416√ó(3.390√ó10‚Å∂)¬≥) ‚âà 3933 –∫–≥/–º¬≥"
            },
            "–Æ–ø–∏—Ç–µ—Ä": {
                "emoji": "‚ôÉ",
                "name_en": "Jupiter",
                "type": "–ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç",
                "mass": "1.8982√ó10¬≤‚Å∑ –∫–≥",
                "radius": "6.9911√ó10‚Å∑ –º",
                "distance": "5.2038 –∞.–µ.",
                "period": "4332.59 –¥–Ω–µ–π",
                "temperature": "165 K (—É—Ä–æ–≤–µ–Ω—å 1 –±–∞—Ä)",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ Juno)",
                "sources": "NASA, Juno, Galileo",
                "task": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ —ç–∫–≤–∞—Ç–æ—Ä–µ",
                "solution": "g = GM/R¬≤ = 6.674√ó10‚Åª¬π¬π√ó1.898√ó10¬≤‚Å∑/(6.991√ó10‚Å∑)¬≤ ‚âà 24.79 –º/—Å¬≤"
            },
            "–°–∞—Ç—É—Ä–Ω": {
                "emoji": "‚ôÑ",
                "name_en": "Saturn",
                "type": "–ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç",
                "mass": "5.6834√ó10¬≤‚Å∂ –∫–≥",
                "radius": "5.8232√ó10‚Å∑ –º",
                "distance": "9.5826 –∞.–µ.",
                "period": "10759.22 –¥–Ω–µ–π",
                "temperature": "134 K (—É—Ä–æ–≤–µ–Ω—å 1 –±–∞—Ä)",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–¥–∞–Ω–Ω—ã–µ Cassini)",
                "sources": "NASA, ESA, Cassini",
                "task": "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å",
                "solution": "œÅ = 3M/(4œÄR¬≥) = 3√ó5.683√ó10¬≤‚Å∂/(4√ó3.1416√ó(5.823√ó10‚Å∑)¬≥) ‚âà 687 –∫–≥/–º¬≥"
            },
            "–£—Ä–∞–Ω": {
                "emoji": "‚ôÖ",
                "name_en": "Uranus",
                "type": "–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç",
                "mass": "8.6810√ó10¬≤‚Åµ –∫–≥",
                "radius": "2.5362√ó10‚Å∑ –º",
                "distance": "19.191 –∞.–µ.",
                "period": "30687.15 –¥–Ω–µ–π",
                "temperature": "76 K (—Ç—Ä–æ–ø–æ–ø–∞—É–∑–∞)",
                "accuracy": "–°—Ä–µ–¥–Ω—è—è (–¥–∞–Ω–Ω—ã–µ Voyager 2)",
                "sources": "NASA, Voyager 2",
                "task": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–æ—Å–º–∏—á–µ—Å–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å",
                "solution": "v‚ÇÅ = ‚àö(GM/R) = ‚àö(6.674√ó10‚Åª¬π¬π√ó8.681√ó10¬≤‚Åµ/2.536√ó10‚Å∑) ‚âà 15.1 –∫–º/—Å"
            },
            "–ù–µ–ø—Ç—É–Ω": {
                "emoji": "‚ôÜ",
                "name_en": "Neptune",
                "type": "–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç",
                "mass": "1.02413√ó10¬≤‚Å∂ –∫–≥",
                "radius": "2.4622√ó10‚Å∑ –º",
                "distance": "30.07 –∞.–µ.",
                "period": "60190.03 –¥–Ω–µ–π",
                "temperature": "72 K (—Ç—Ä–æ–ø–æ–ø–∞—É–∑–∞)",
                "accuracy": "–°—Ä–µ–¥–Ω—è—è (–¥–∞–Ω–Ω—ã–µ Voyager 2)",
                "sources": "NASA, Voyager 2",
                "task": "–°—Ä–∞–≤–Ω–∏—Ç—å —Å –£—Ä–∞–Ω–æ–º",
                "solution": "M_–ù–µ–ø—Ç—É–Ω–∞/M_–£—Ä–∞–Ω–∞ = 1.024√ó10¬≤‚Å∂/8.681√ó10¬≤‚Åµ ‚âà 1.18"
            },
            "–°–∏—Ä–∏—É—Å": {
                "emoji": "‚≠êÔ∏è",
                "name_en": "Sirius",
                "type": "–î–≤–æ–π–Ω–∞—è –∑–≤–µ–∑–¥–∞ (A1V + DA2)",
                "mass": "2.02 M‚òâ (–°–∏—Ä–∏—É—Å A)",
                "radius": "1.71 R‚òâ",
                "distance": "2.64 –ø–∫ (8.6 —Å–≤. –ª–µ—Ç)",
                "luminosity": "25.4 L‚òâ",
                "temperature": "9940 K",
                "accuracy": "–í—ã—Å–æ–∫–∞—è (–ø–∞—Ä–∞–ª–ª–∞–∫—Å Hipparcos)",
                "sources": "Hipparcos, Hubble, Gaia",
                "task": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—É—é –∑–≤–µ–∑–¥–Ω—É—é –≤–µ–ª–∏—á–∏–Ω–∞",
                "solution": "M = m - 5lg(d/10) = -1.46 - 5lg(2.64/10) ‚âà +1.42"
            }
        }

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª
        self.save_data()
        print(f"üìÅ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª {self.json_file} —Å –ø—Ä–∏–º–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏")

    def save_data(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ JSON —Ñ–∞–π–ª"""
        try:
            with open(self.json_file, 'w', encoding='utf-8') as f:
                json.dump(self.data, f, ensure_ascii=False, indent=2)
            print(f"‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {self.json_file}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}")

    def parse_scientific_number(self, value_str):
        """
        –ü–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª –≤ –Ω–∞—É—á–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏

        Args:
            value_str (str): –°—Ç—Ä–æ–∫–∞ —Å —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "6.371√ó10‚Å∂ –º")

        Returns:
            float: –ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
        """
        if not value_str:
            return None

        try:
            # –£–¥–∞–ª—è–µ–º –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
            value_str = re.sub(r'[^\d√ó\.eE\+\-^‚Å∞¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ]', '', value_str)

            # –ó–∞–º–µ–Ω—è–µ–º —Å–∏–º–≤–æ–ª—ã —Å—Ç–µ–ø–µ–Ω–∏ –Ω–∞ –æ–±—ã—á–Ω—ã–µ —á–∏—Å–ª–∞
            superscript_map = {
                '‚Å∞': '0', '¬π': '1', '¬≤': '2', '¬≥': '3', '‚Å¥': '4',
                '‚Åµ': '5', '‚Å∂': '6', '‚Å∑': '7', '‚Å∏': '8', '‚Åπ': '9'
            }

            for sup, num in superscript_map.items():
                value_str = value_str.replace(sup, num)

            # –ó–∞–º–µ–Ω—è–µ–º √ó –Ω–∞ *
            value_str = value_str.replace('√ó', '*')

            # –ó–∞–º–µ–Ω—è–µ–º ^ –Ω–∞ ** –¥–ª—è Python
            value_str = value_str.replace('^', '**')

            # –í—ã—á–∏—Å–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            return eval(value_str)

        except Exception as e:
            print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —á–∏—Å–ª–æ: {value_str}")
            return None

    def calculate_density(self, body_name):
        """
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –Ω–µ–±–µ—Å–Ω–æ–≥–æ —Ç–µ–ª–∞

        Args:
            body_name (str): –ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

        Returns:
            dict: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –∏–ª–∏ None –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
        """
        body = self.data.get(body_name)
        if not body:
            return None

        try:
            mass_str = body.get('mass', '')
            radius_str = body.get('radius', '')

            mass = self.parse_scientific_number(mass_str)
            radius = self.parse_scientific_number(radius_str)

            if mass is None or radius is None:
                return None

            volume = (4 / 3) * 3.1415926535 * (radius ** 3)

            density = mass / volume if volume > 0 else 0

            return {
                'name': body_name,
                'mass_kg': mass,
                'radius_m': radius,
                'volume_m3': volume,
                'density_kg_m3': density,
                'density_g_cm3': density / 1000,
                'formula': 'œÅ = 3M/(4œÄR¬≥)'
            }

        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏: {e}")
            return None


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
celestial_db = CelestialDatabase('celestial_data.json')
CELESTIAL_DATA = celestial_db.data

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
if not CELESTIAL_DATA:
    print("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
    print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª celestial_data.json –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ")
    exit(1)


# ==================== KEEP-ALIVE ====================
def keep_alive():
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"""
    WEB_URL = "https://narine.pythonanywhere.com/"
    print("‚úÖ Keep-alive —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞")

    while True:
        try:
            response = requests.get(WEB_URL, timeout=5)
            print(f"üü¢ Ping —É—Å–ø–µ—à–µ–Ω: {response.status_code} –≤ {time.strftime('%H:%M:%S')}")
        except Exception as e:
            print(f"üî¥ Ping –Ω–µ—É–¥–∞—á–µ–Ω: {e} –≤ {time.strftime('%H:%M:%S')}")
        time.sleep(240)


# ==================== –ö–õ–ê–í–ò–ê–¢–£–†–´ ====================
def get_main_keyboard():
    """–û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞"""
    keyboard = [
        [KeyboardButton("ü™ê 8 –ü–ª–∞–Ω–µ—Ç"), KeyboardButton("‚≠êÔ∏è –°–∏—Ä–∏—É—Å"), KeyboardButton("‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ")],
        [KeyboardButton("üìä –°—Ä–∞–≤–Ω–∏—Ç—å"), KeyboardButton("üìù –ó–∞–¥–∞—á–∏"), KeyboardButton("üî¨ –ú–µ—Ç–æ–¥—ã")],
        [KeyboardButton("‚ùì –ü–æ–º–æ—â—å")]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True, one_time_keyboard=False)


def get_planets_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å 8 –ø–ª–∞–Ω–µ—Ç–∞–º–∏ (–±–µ–∑ –°–∏—Ä–∏—É—Å–∞ –∏ –°–æ–ª–Ω—Ü–∞)"""
    keyboard = [
        [InlineKeyboardButton("‚òø –ú–µ—Ä–∫—É—Ä–∏–π", callback_data="body_–ú–µ—Ä–∫—É—Ä–∏–π"),
         InlineKeyboardButton("‚ôÄ –í–µ–Ω–µ—Ä–∞", callback_data="body_–í–µ–Ω–µ—Ä–∞")],
        [InlineKeyboardButton("üåç –ó–µ–º–ª—è", callback_data="body_–ó–µ–º–ª—è"),
         InlineKeyboardButton("‚ôÇ –ú–∞—Ä—Å", callback_data="body_–ú–∞—Ä—Å")],
        [InlineKeyboardButton("‚ôÉ –Æ–ø–∏—Ç–µ—Ä", callback_data="body_–Æ–ø–∏—Ç–µ—Ä"),
         InlineKeyboardButton("‚ôÑ –°–∞—Ç—É—Ä–Ω", callback_data="body_–°–∞—Ç—É—Ä–Ω")],
        [InlineKeyboardButton("‚ôÖ –£—Ä–∞–Ω", callback_data="body_–£—Ä–∞–Ω"),
         InlineKeyboardButton("‚ôÜ –ù–µ–ø—Ç—É–Ω", callback_data="body_–ù–µ–ø—Ç—É–Ω")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é", callback_data="back_main")]
    ]
    return InlineKeyboardMarkup(keyboard)


def get_compare_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"""
    keyboard = [
        [InlineKeyboardButton("–ó–µ–º–ª—è vs –ú–∞—Ä—Å", callback_data="compare_–ó–µ–º–ª—è_–ú–∞—Ä—Å"),
         InlineKeyboardButton("–í–µ–Ω–µ—Ä–∞ vs –ó–µ–º–ª—è", callback_data="compare_–í–µ–Ω–µ—Ä–∞_–ó–µ–º–ª—è")],
        [InlineKeyboardButton("–Æ–ø–∏—Ç–µ—Ä vs –°–∞—Ç—É—Ä–Ω", callback_data="compare_–Æ–ø–∏—Ç–µ—Ä_–°–∞—Ç—É—Ä–Ω"),
         InlineKeyboardButton("–°–æ–ª–Ω—Ü–µ vs –°–∏—Ä–∏—É—Å", callback_data="compare_–°–æ–ª–Ω—Ü–µ_–°–∏—Ä–∏—É—Å")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é", callback_data="back_main")]
    ]
    return InlineKeyboardMarkup(keyboard)


def get_tasks_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∑–∞–¥–∞—á–∞–º–∏"""
    keyboard = [
        [InlineKeyboardButton("üìê –ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏", callback_data="task_velocity"),
         InlineKeyboardButton("‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å", callback_data="task_mass")],
        [InlineKeyboardButton("üåç –°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏", callback_data="task_gravity"),
         InlineKeyboardButton("üîÑ –ü–µ—Ä–∏–æ–¥—ã", callback_data="task_period")],
        [InlineKeyboardButton("‚≠êÔ∏è –ó–≤–µ–∑–¥–Ω—ã–µ –∑–∞–¥–∞—á–∏", callback_data="task_stars")],
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é", callback_data="back_main")]
    ]
    return InlineKeyboardMarkup(keyboard)


# ==================== –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´ ====================
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    welcome = """
üöÄ *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AstroBot!*
*–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–ª—è –æ–ª–∏–º–ø–∏–∞–¥–Ω–æ–π –∞—Å—Ç—Ä–æ–Ω–æ–º–∏–∏*

*–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:*
‚Ä¢ ‚òÄÔ∏è **–°–æ–ª–Ω—Ü–µ** - –Ω–∞—à–∞ –∑–≤–µ–∑–¥–∞
‚Ä¢ ü™ê **8 –ü–ª–∞–Ω–µ—Ç** - –æ—Ç –ú–µ—Ä–∫—É—Ä–∏—è –¥–æ –ù–µ–ø—Ç—É–Ω–∞
‚Ä¢ ‚≠êÔ∏è **–°–∏—Ä–∏—É—Å** - —Å–∞–º–∞—è —è—Ä–∫–∞—è –∑–≤–µ–∑–¥–∞

*–§—É–Ω–∫—Ü–∏–∏:*
üìä **–°—Ä–∞–≤–Ω–∏—Ç—å** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –æ–±—ä–µ–∫—Ç–æ–≤
üìù **–ó–∞–¥–∞—á–∏** - –æ–ª–∏–º–ø–∏–∞–¥–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏
üî¨ **–ú–µ—Ç–æ–¥—ã** - –º–µ—Ç–æ–¥–∏–∫–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–π
‚ùì **–ü–æ–º–æ—â—å** - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É

*–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞:*
"""
    await update.message.reply_text(welcome, parse_mode='Markdown', reply_markup=get_main_keyboard())


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    text = update.message.text

    if text == "ü™ê 8 –ü–ª–∞–Ω–µ—Ç":
        await update.message.reply_text(
            "üåå *–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω–µ—Ç—É:*\n(8 –ø–ª–∞–Ω–µ—Ç –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã)",
            parse_mode='Markdown',
            reply_markup=get_planets_keyboard()
        )

    elif text == "‚≠êÔ∏è –°–∏—Ä–∏—É—Å":
        await show_celestial_body_direct(update, "–°–∏—Ä–∏—É—Å")

    elif text == "‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ":
        await show_celestial_body_direct(update, "–°–æ–ª–Ω—Ü–µ")

    elif text == "üìä –°—Ä–∞–≤–Ω–∏—Ç—å":
        await update.message.reply_text(
            "‚öñÔ∏è *–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:*",
            parse_mode='Markdown',
            reply_markup=get_compare_keyboard()
        )

    elif text == "üìù –ó–∞–¥–∞—á–∏":
        await update.message.reply_text(
            "üìö *–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞—á–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:*",
            parse_mode='Markdown',
            reply_markup=get_tasks_keyboard()
        )

    elif text == "üî¨ –ú–µ—Ç–æ–¥—ã":
        await show_methods(update)

    elif text == "‚ùì –ü–æ–º–æ—â—å":
        await show_help(update)

    elif text.lower().startswith("–ø–ª–æ—Ç–Ω–æ—Å—Ç—å:"):
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
        await calculate_density_from_text(update, context, text)

    else:
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é ‚¨áÔ∏è",
            reply_markup=get_main_keyboard()
        )


# ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –î–ê–ù–ù–´–ú–ò ====================
async def show_celestial_body_direct(update: Update, body_name: str):
    """–ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–±–µ—Å–Ω–æ–º —Ç–µ–ª–µ"""
    if body_name not in CELESTIAL_DATA:
        await update.message.reply_text(
            f"‚ùå –û–±—ä–µ–∫—Ç '{body_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.",
            reply_markup=get_main_keyboard()
        )
        return

    body = CELESTIAL_DATA[body_name]
    await send_body_info(update.message, body_name, body)


async def show_celestial_body_inline(query, body_name: str):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫—É"""
    if body_name not in CELESTIAL_DATA:
        await query.edit_message_text(
            f"‚ùå –û–±—ä–µ–∫—Ç '{body_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.",
            parse_mode='Markdown'
        )
        return

    body = CELESTIAL_DATA[body_name]
    response = format_body_info(body_name, body)

    # –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –ø–ª–∞–Ω–µ—Ç–∞–º" - —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–ª–∞–Ω–µ—Ç, –Ω–µ –¥–ª—è –∑–≤–µ–∑–¥
    if body_name in ["–ú–µ—Ä–∫—É—Ä–∏–π", "–í–µ–Ω–µ—Ä–∞", "–ó–µ–º–ª—è", "–ú–∞—Ä—Å", "–Æ–ø–∏—Ç–µ—Ä", "–°–∞—Ç—É—Ä–Ω", "–£—Ä–∞–Ω", "–ù–µ–ø—Ç—É–Ω"]:
        keyboard = [[InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ –ø–ª–∞–Ω–µ—Ç–∞–º", callback_data="back_planets")]]
    else:
        keyboard = [[InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é", callback_data="back_main")]]

    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(response, parse_mode='Markdown', reply_markup=reply_markup)


def format_body_info(body_name: str, body: dict) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–µ–±–µ—Å–Ω–æ–º —Ç–µ–ª–µ"""
    response = f"{body['emoji']} *{body_name.upper()}* ({body['name_en']})\n\n"
    response += f"üìå *–¢–∏–ø:* {body['type']}\n\n"

    response += f"‚öñÔ∏è *–ú–∞—Å—Å–∞:* {body['mass']}\n"
    response += f"üìè *–†–∞–¥–∏—É—Å:* {body['radius']}\n"

    if 'distance' in body and body['distance']:
        response += f"üìç *–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:* {body['distance']}\n"

    if 'period' in body and body['period']:
        response += f"üîÑ *–ü–µ—Ä–∏–æ–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è:* {body['period']}\n"

    if 'luminosity' in body and body['luminosity']:
        response += f"‚òÄÔ∏è *–°–≤–µ—Ç–∏–º–æ—Å—Ç—å:* {body['luminosity']}\n"

    if 'temperature' in body and body['temperature']:
        response += f"üå°Ô∏è *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:* {body['temperature']}\n"

    response += f"\nüìä *–¢–æ—á–Ω–æ—Å—Ç—å:* {body['accuracy']}\n"
    response += f"üìö *–ò—Å—Ç–æ—á–Ω–∏–∫–∏:* {body['sources']}\n\n"
    response += f"üéØ *{body['task']}*\n\n"
    response += body['solution']
    response += "\n\n_–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ–ª–∏–º–ø–∏–∞–¥–Ω—ã—Ö –∑–∞–¥–∞—á!_"

    return response


async def send_body_info(message, body_name: str, body: dict):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–µ–±–µ—Å–Ω–æ–º —Ç–µ–ª–µ"""
    response = format_body_info(body_name, body)
    await message.reply_text(response, parse_mode='Markdown', reply_markup=get_main_keyboard())


# ==================== –°–†–ê–í–ù–ï–ù–ò–ï ====================
async def show_comparison(query, body1: str, body2: str):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ"""
    if body1 not in CELESTIAL_DATA or body2 not in CELESTIAL_DATA:
        await query.edit_message_text("‚ùå –û–¥–∏–Ω –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.")
        return

    b1 = CELESTIAL_DATA[body1]
    b2 = CELESTIAL_DATA[body2]

    response = f"üìä *–°–†–ê–í–ù–ï–ù–ò–ï: {b1['emoji']} {body1} vs {b2['emoji']} {body2}*\n\n"

    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å—ã
    response += f"‚öñÔ∏è *–ú–∞—Å—Å–∞:*\n‚Ä¢ {body1}: {b1['mass']}\n‚Ä¢ {body2}: {b2['mass']}\n\n"

    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞
    response += f"üìè *–†–∞–¥–∏—É—Å:*\n‚Ä¢ {body1}: {b1['radius']}\n‚Ä¢ {body2}: {b2['radius']}\n\n"

    # –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    if body1 == "–ó–µ–º–ª—è" and body2 == "–ú–∞—Ä—Å":
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
        density1 = celestial_db.calculate_density("–ó–µ–º–ª—è")
        density2 = celestial_db.calculate_density("–ú–∞—Ä—Å")

        if density1 and density2:
            response += f"üìè *–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:*\n"
            response += f"‚Ä¢ –ó–µ–º–ª—è: {density1['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –ú–∞—Ä—Å: {density2['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏–µ: {density1['density_kg_m3'] / density2['density_kg_m3']:.2f}\n\n"

        response += """üìù **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏–ª—ã —Ç—è–∂–µ—Å—Ç–∏:**
g_–ó–µ–º–ª—è = 9.81 –º/—Å¬≤
g_–ú–∞—Ä—Å = 3.71 –º/—Å¬≤
–û—Ç–Ω–æ—à–µ–Ω–∏–µ: g_–ú–∞—Ä—Å/g_–ó–µ–º–ª—è = 3.71/9.81 ‚âà 0.38

üìê **–§–æ—Ä–º—É–ª–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:** g‚ÇÅ/g‚ÇÇ = (M‚ÇÅ/M‚ÇÇ) √ó (R‚ÇÇ¬≤/R‚ÇÅ¬≤)

üéØ **–í—ã–≤–æ–¥:** –°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ –Ω–∞ –ú–∞—Ä—Å–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ~38% –æ—Ç –∑–µ–º–Ω–æ–π
"""

    elif body1 == "–í–µ–Ω–µ—Ä–∞" and body2 == "–ó–µ–º–ª—è":
        density1 = celestial_db.calculate_density("–í–µ–Ω–µ—Ä–∞")
        density2 = celestial_db.calculate_density("–ó–µ–º–ª—è")

        if density1 and density2:
            response += f"üìè *–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:*\n"
            response += f"‚Ä¢ –í–µ–Ω–µ—Ä–∞: {density1['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –ó–µ–º–ª—è: {density2['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏–µ: {density1['density_kg_m3'] / density2['density_kg_m3']:.2f}\n\n"

        response += """üìù **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏–ª—ã —Ç—è–∂–µ—Å—Ç–∏:**
g_–í–µ–Ω–µ—Ä–∞ = 8.87 –º/—Å¬≤
g_–ó–µ–º–ª—è = 9.81 –º/—Å¬≤
–û—Ç–Ω–æ—à–µ–Ω–∏–µ: g_–í–µ–Ω–µ—Ä–∞/g_–ó–µ–º–ª—è = 8.87/9.81 ‚âà 0.904

üìê **–§–æ—Ä–º—É–ª–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:** g = GM/R¬≤

üéØ **–í—ã–≤–æ–¥:** –°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ –Ω–∞ –í–µ–Ω–µ—Ä–µ ~90% –æ—Ç –∑–µ–º–Ω–æ–π, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –±–ª–∏–∑–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã
"""

    elif body1 == "–Æ–ø–∏—Ç–µ—Ä" and body2 == "–°–∞—Ç—É—Ä–Ω":
        density1 = celestial_db.calculate_density("–Æ–ø–∏—Ç–µ—Ä")
        density2 = celestial_db.calculate_density("–°–∞—Ç—É—Ä–Ω")

        if density1 and density2:
            response += f"üìè *–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:*\n"
            response += f"‚Ä¢ –Æ–ø–∏—Ç–µ—Ä: {density1['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –°–∞—Ç—É—Ä–Ω: {density2['density_kg_m3']:.0f} –∫–≥/–º¬≥\n"
            response += f"‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏–µ: {density1['density_kg_m3'] / density2['density_kg_m3']:.2f}\n\n"

        response += """üìù **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏:**
œÅ_–Æ–ø–∏—Ç–µ—Ä = 1.33 –≥/—Å–º¬≥
œÅ_–°–∞—Ç—É—Ä–Ω = 0.69 –≥/—Å–º¬≥
–û—Ç–Ω–æ—à–µ–Ω–∏–µ: œÅ_–Æ–ø–∏—Ç–µ—Ä/œÅ_–°–∞—Ç—É—Ä–Ω ‚âà 1.93

üìê **–§–æ—Ä–º—É–ª–∞:** œÅ = 3M/(4œÄR¬≥)

üéØ **–í—ã–≤–æ–¥:** –Æ–ø–∏—Ç–µ—Ä –ø–æ—á—Ç–∏ –≤ 2 —Ä–∞–∑–∞ –ø–ª–æ—Ç–Ω–µ–µ –°–∞—Ç—É—Ä–Ω–∞
"""

    elif body1 == "–°–æ–ª–Ω—Ü–µ" and body2 == "–°–∏—Ä–∏—É—Å":
        response += """üìù **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–≤–µ—Ç–∏–º–æ—Å—Ç–∏:**
L_–°–æ–ª–Ω—Ü–µ = 1 L‚òâ
L_–°–∏—Ä–∏—É—Å = 25.4 L‚òâ
–û—Ç–Ω–æ—à–µ–Ω–∏–µ: L_–°–∏—Ä–∏—É—Å/L_–°–æ–ª–Ω—Ü–µ = 25.4

üìê **–§–æ—Ä–º—É–ª–∞:** L ‚àù M¬≥¬∑‚Åµ (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–∞—Å—Å–∞-—Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –¥–ª—è –≥–ª–∞–≤–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

üéØ **–í—ã–≤–æ–¥:** –°–∏—Ä–∏—É—Å –≤ 25.4 —Ä–∞–∑–∞ —è—Ä—á–µ –°–æ–ª–Ω—Ü–∞
"""

    keyboard = [[InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é", callback_data="back_compare")]]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(response, parse_mode='Markdown', reply_markup=reply_markup)


# ==================== –ó–ê–î–ê–ß–ò ====================
async def show_task_with_solution(query, task_type: str):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–¥–∞—á—É —Å –ø–æ–ª–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º"""
    tasks = {
        "velocity": """
üöÄ **–ó–ê–î–ê–ß–ê: –ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ú–∞—Ä—Å–∞**

üìù **–£—Å–ª–æ–≤–∏–µ:**
–í—ã—á–∏—Å–ª–∏—Ç–µ –ø–µ—Ä–≤—É—é –∏ –≤—Ç–æ—Ä—É—é –∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –ú–∞—Ä—Å–∞.

üìê **–§–æ—Ä–º—É–ª—ã:**
1. –ü–µ—Ä–≤–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫—Ä—É–≥–æ–≤–∞—è –æ—Ä–±–∏—Ç–∞):
   v‚ÇÅ = ‚àö(GM/R)
2. –í—Ç–æ—Ä–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–ø–∞—Ä–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è):
   v‚ÇÇ = ‚àö(2GM/R) = v‚ÇÅ‚àö2

üî¢ **–î–∞–Ω–Ω—ã–µ –¥–ª—è –ú–∞—Ä—Å–∞:**
- G = 6.67430√ó10‚Åª¬π¬π –º¬≥/(–∫–≥¬∑—Å¬≤) (–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è)
- M_–ú–∞—Ä—Å = 6.4171√ó10¬≤¬≥ –∫–≥ (–º–∞—Å—Å–∞ –ú–∞—Ä—Å–∞)
- R_–ú–∞—Ä—Å = 3.3895√ó10‚Å∂ –º (—Å—Ä–µ–¥–Ω–∏–π —Ä–∞–¥–∏—É—Å –ú–∞—Ä—Å–∞)

üìù **–†–µ—à–µ–Ω–∏–µ:**
1. **–ü–µ—Ä–≤–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:**
   v‚ÇÅ = ‚àö(6.67430√ó10‚Åª¬π¬π √ó 6.4171√ó10¬≤¬≥ / 3.3895√ó10‚Å∂)
   v‚ÇÅ = ‚àö(4.284√ó10¬π¬≥ / 3.3895√ó10‚Å∂) 
   v‚ÇÅ = ‚àö(1.264√ó10‚Å∑) ‚âà 3.56√ó10¬≥ –º/—Å

2. **–í—Ç–æ—Ä–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:**
   v‚ÇÇ = ‚àö(2) √ó v‚ÇÅ = 1.414 √ó 3.56√ó10¬≥ ‚âà 5.03√ó10¬≥ –º/—Å

üéØ **–û—Ç–≤–µ—Ç—ã:**
- –ü–µ—Ä–≤–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ú–∞—Ä—Å–∞: **~3.56 –∫–º/—Å**
- –í—Ç–æ—Ä–∞—è –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ú–∞—Ä—Å–∞: **~5.03 –∫–º/—Å**

üìä **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ó–µ–º–ª–µ–π:**
- –ó–µ–º–ª—è: v‚ÇÅ = 7.91 –∫–º/—Å, v‚ÇÇ = 11.2 –∫–º/—Å
- –ú–∞—Ä—Å –≤ 2.2 —Ä–∞–∑–∞ –ª–µ–≥—á–µ —É–¥–µ—Ä–∂–∞—Ç—å –Ω–∞ –æ—Ä–±–∏—Ç–µ!

‚ö° **–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:** –ù–∞ –ú–∞—Ä—Å–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∫–µ—Ç—ã –ø—Ä–æ—â–µ - –Ω—É–∂–Ω–æ –Ω–∞ 55% –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏!
""",

        "mass": """
‚öñÔ∏è **–ó–ê–î–ê–ß–ê: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å –ø–ª–∞–Ω–µ—Ç-–≥–∏–≥–∞–Ω—Ç–æ–≤**

üìù **–£—Å–ª–æ–≤–∏–µ:**
–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–∞—Å—Å–∞ –Æ–ø–∏—Ç–µ—Ä–∞ –±–æ–ª—å—à–µ –º–∞—Å—Å—ã –°–∞—Ç—É—Ä–Ω–∞?
–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –°–æ–ª–Ω—Ü–µ –º–∞—Å—Å–∏–≤–Ω–µ–µ –≤—Å–µ—Ö –ø–ª–∞–Ω–µ—Ç –≤–º–µ—Å—Ç–µ?

üìê **–§–æ—Ä–º—É–ª–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–∞—Å—Å:**
N = M‚ÇÅ/M‚ÇÇ

üî¢ **–î–∞–Ω–Ω—ã–µ:**
- M_–Æ–ø–∏—Ç–µ—Ä = 1.8982√ó10¬≤‚Å∑ –∫–≥
- M_–°–∞—Ç—É—Ä–Ω = 5.6834√ó10¬≤‚Å∂ –∫–≥
- M_–°–æ–ª–Ω—Ü–µ = 1.9885√ó10¬≥‚Å∞ –∫–≥
- M_–≤—Å–µ—Ö_–ø–ª–∞–Ω–µ—Ç ‚âà 2.66√ó10¬≤‚Å∑ –∫–≥

üìù **–†–µ—à–µ–Ω–∏–µ:**

1. **–Æ–ø–∏—Ç–µ—Ä vs –°–∞—Ç—É—Ä–Ω:**
   N = M_–Æ–ø–∏—Ç–µ—Ä / M_–°–∞—Ç—É—Ä–Ω
   N = 1.8982√ó10¬≤‚Å∑ / 5.6834√ó10¬≤‚Å∂
   N = 3.339

2. **–°–æ–ª–Ω—Ü–µ vs –≤—Å–µ –ø–ª–∞–Ω–µ—Ç—ã:**
   N = M_–°–æ–ª–Ω—Ü–µ / M_–≤—Å–µ—Ö_–ø–ª–∞–Ω–µ—Ç
   N = 1.9885√ó10¬≥‚Å∞ / 2.66√ó10¬≤‚Å∑
   N ‚âà 747

üéØ **–û—Ç–≤–µ—Ç—ã:**
1. –Æ–ø–∏—Ç–µ—Ä –≤ **3.34 —Ä–∞–∑–∞** –º–∞—Å—Å–∏–≤–Ω–µ–µ –°–∞—Ç—É—Ä–Ω–∞
2. –°–æ–ª–Ω—Ü–µ –≤ **~750 —Ä–∞–∑** –º–∞—Å—Å–∏–≤–Ω–µ–µ –≤—Å–µ—Ö –ø–ª–∞–Ω–µ—Ç –≤–º–µ—Å—Ç–µ!

üìä **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å—ã –≤ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ:**
- –°–æ–ª–Ω—Ü–µ: 99.86%
- –Æ–ø–∏—Ç–µ—Ä: 0.10%
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã: 0.04%

‚ö° **–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:** –Æ–ø–∏—Ç–µ—Ä –≤ 2.5 —Ä–∞–∑–∞ –º–∞—Å—Å–∏–≤–Ω–µ–µ, —á–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã –≤–º–µ—Å—Ç–µ –≤–∑—è—Ç—ã–µ!
""",

        "gravity": """
üåç **–ó–ê–î–ê–ß–ê: –°–∏–ª–∞ —Ç—è–∂–µ—Å—Ç–∏ –Ω–∞ –ø–ª–∞–Ω–µ—Ç–∞—Ö –∑–µ–º–Ω–æ–π –≥—Ä—É–ø–ø—ã**

üìù **–£—Å–ª–æ–≤–∏–µ:**
–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è –Ω–∞ –í–µ–Ω–µ—Ä–µ –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –µ–≥–æ —Å –∑–µ–º–Ω—ã–º.

üìê **–§–æ—Ä–º—É–ª–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è:**
g = GM/R¬≤

–≥–¥–µ:
- G = 6.67430√ó10‚Åª¬π¬π –º¬≥/(–∫–≥¬∑—Å¬≤) - –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è
- M - –º–∞—Å—Å–∞ –ø–ª–∞–Ω–µ—Ç—ã (–∫–≥)
- R - —Ä–∞–¥–∏—É—Å –ø–ª–∞–Ω–µ—Ç–µ (–º)

üî¢ **–î–∞–Ω–Ω—ã–µ –¥–ª—è –í–µ–Ω–µ—Ä—ã:**
- M_–í–µ–Ω–µ—Ä–∞ = 4.8675√ó10¬≤‚Å¥ –∫–≥
- R_–í–µ–Ω–µ—Ä–∞ = 6.0518√ó10‚Å∂ –º
- M_–ó–µ–º–ª—è = 5.9722√ó10¬≤‚Å¥ –∫–≥
- R_–ó–µ–º–ª—è = 6.371√ó10‚Å∂ –º

üìù **–†–µ—à–µ–Ω–∏–µ:**

1. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ –í–µ–Ω–µ—Ä–µ:**
   g_–í = (6.67430√ó10‚Åª¬π¬π √ó 4.8675√ó10¬≤‚Å¥) / (6.0518√ó10‚Å∂)¬≤
   g_–í = 3.248√ó10¬π‚Å¥ / 3.663√ó10¬π¬≥
   g_–í ‚âà 8.87 –º/—Å¬≤

2. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ –ó–µ–º–ª–µ:**
   g_–ó = (6.67430√ó10‚Åª¬π¬π √ó 5.9722√ó10¬≤‚Å¥) / (6.371√ó10‚Å∂)¬≤
   g_–ó = 3.985√ó10¬π‚Å¥ / 4.059√ó10¬π¬≥
   g_–ó ‚âà 9.82 –º/—Å¬≤

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
   g_–í / g_–ó = 8.87 / 9.82 ‚âà 0.903

üéØ **–û—Ç–≤–µ—Ç—ã:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è –Ω–∞ –í–µ–Ω–µ—Ä–µ: **8.87 –º/—Å¬≤**
- –ù–∞ –ó–µ–º–ª–µ: **9.82 –º/—Å¬≤**
- –û—Ç–Ω–æ—à–µ–Ω–∏–µ: **~0.90** (90% –æ—Ç –∑–µ–º–Ω–æ–≥–æ)

üìä **–¢–∞–±–ª–∏—Ü–∞ —É—Å–∫–æ—Ä–µ–Ω–∏–π (–º/—Å¬≤):**
- –ú–µ—Ä–∫—É—Ä–∏–π: 3.70
- –í–µ–Ω–µ—Ä–∞: 8.87  
- –ó–µ–º–ª—è: 9.82
- –ú–∞—Ä—Å: 3.71
- –õ—É–Ω–∞: 1.62

‚ö° **–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:** –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –±–ª–∏–∑–∫—É—é –º–∞—Å—Å—É, g –Ω–∞ –í–µ–Ω–µ—Ä–µ –º–µ–Ω—å—à–µ –∏–∑-–∑–∞ –±–æ–ª—å—à–µ–≥–æ —Ä–∞–¥–∏—É—Å–∞!
""",

        "period": """
üîÑ **–ó–ê–î–ê–ß–ê: –û—Ä–±–∏—Ç–∞–ª—å–Ω—ã–µ –∏ —Å–∏–Ω–æ–¥–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã**

üìù **–£—Å–ª–æ–≤–∏–µ 1:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–∏–Ω–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –í–µ–Ω–µ—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ó–µ–º–ª–∏.

üìê **–§–æ—Ä–º—É–ª–∞ —Å–∏–Ω–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞:**
1/S = 1/T‚ÇÅ - 1/T‚ÇÇ
–≥–¥–µ:
- S - —Å–∏–Ω–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥
- T‚ÇÅ - —Å–∏–¥–µ—Ä–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–ª–∞–Ω–µ—Ç—ã
- T‚ÇÇ - —Å–∏–¥–µ—Ä–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –ó–µ–º–ª–∏

üî¢ **–î–∞–Ω–Ω—ã–µ:**
- T_–í–µ–Ω–µ—Ä–∞ = 224.7 –¥–Ω–µ–π
- T_–ó–µ–º–ª—è = 365.25 –¥–Ω–µ–π

üìù **–†–µ—à–µ–Ω–∏–µ:**
1/S = 1/224.7 - 1/365.25
1/S = 0.004451 - 0.002738 = 0.001713
S = 1/0.001713 ‚âà 583.8 –¥–Ω–µ–π

üéØ **–û—Ç–≤–µ—Ç 1:** –°–∏–Ω–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –í–µ–Ω–µ—Ä—ã **~584 –¥–Ω—è**

---

üìù **–£—Å–ª–æ–≤–∏–µ 2:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ III –∑–∞–∫–æ–Ω –ö–µ–ø–ª–µ—Ä–∞ –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏—è.

üìê **–§–æ—Ä–º—É–ª–∞ III –∑–∞–∫–æ–Ω–∞ –ö–µ–ø–ª–µ—Ä–∞:**
T¬≤/a¬≥ = const (–≤ –≥–æ–¥–∞—Ö –∏ –∞.–µ.)

üî¢ **–î–∞–Ω–Ω—ã–µ –¥–ª—è –ú–µ—Ä–∫—É—Ä–∏—è:**
- T = 0.241 –≥–æ–¥–∞ (87.97/365.25)
- a = 0.3871 –∞.–µ.

üìù **–†–µ—à–µ–Ω–∏–µ:**
T¬≤/a¬≥ = (0.241)¬≤ / (0.3871)¬≥
T¬≤/a¬≥ = 0.05808 / 0.05799 ‚âà 1.0015

üéØ **–û—Ç–≤–µ—Ç 2:** –ó–∞–∫–æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é **0.15%**

---

üìä **–¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–∏–æ–¥–æ–≤ (–¥–Ω–∏):**
- –ú–µ—Ä–∫—É—Ä–∏–π: 87.97 (—Å–∏–¥.), 115.9 (—Å–∏–Ω–æ–¥.)
- –í–µ–Ω–µ—Ä–∞: 224.7 (—Å–∏–¥.), 583.9 (—Å–∏–Ω–æ–¥.)
- –ó–µ–º–ª—è: 365.25
- –ú–∞—Ä—Å: 687.0 (—Å–∏–¥.), 779.9 (—Å–∏–Ω–æ–¥.)

‚ö° **–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:** –°–∏–Ω–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥ –í–µ–Ω–µ—Ä—ã - –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—á–µ–º—É –æ–Ω–∞ –≤–∏–¥–Ω–∞ –∫–∞–∫ "—É—Ç—Ä–µ–Ω–Ω—è—è" –∏–ª–∏ "–≤–µ—á–µ—Ä–Ω—è—è" –∑–≤–µ–∑–¥–∞!
""",

        "stars": """
‚≠êÔ∏è **–ó–ê–î–ê–ß–ê: –ó–≤–µ–∑–¥–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –°–∏—Ä–∏—É—Å–∞**

üìù **–£—Å–ª–æ–≤–∏–µ 1:** –í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –°–∏—Ä–∏—É—Å —è—Ä—á–µ –°–æ–ª–Ω—Ü–∞?

üî¢ **–î–∞–Ω–Ω—ã–µ:**
- L_–°–∏—Ä–∏—É—Å = 25.4 L‚òâ (—Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –≤ —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö)
- L_–°–æ–ª–Ω—Ü–µ = 1 L‚òâ
- M_–°–∏—Ä–∏—É—Å = 2.02 M‚òâ
- R_–°–∏—Ä–∏—É—Å = 1.71 R‚òâ

üìù **–†–µ—à–µ–Ω–∏–µ:**
N = L_–°–∏—Ä–∏—É—Å / L_–°–æ–ª–Ω—Ü–µ = 25.4 / 1 = 25.4

üéØ **–û—Ç–≤–µ—Ç 1:** –°–∏—Ä–∏—É—Å –≤ **25.4 —Ä–∞–∑–∞** —è—Ä—á–µ –°–æ–ª–Ω—Ü–∞

---

üìù **–£—Å–ª–æ–≤–∏–µ 2:** –û—Ü–µ–Ω–∏—Ç–µ —Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –∑–≤–µ–∑–¥–∞ –º–∞—Å—Å–æ–π 5 M‚òâ.

üìê **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–∞—Å—Å–∞-—Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –¥–ª—è –≥–ª–∞–≤–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
L ‚àù M¬≥¬∑‚Åµ

üìù **–†–µ—à–µ–Ω–∏–µ:**
L/L‚òâ = (M/M‚òâ)¬≥¬∑‚Åµ = 5¬≥¬∑‚Åµ
5¬≥¬∑‚Åµ = 5¬≥ √ó ‚àö5 = 125 √ó 2.236 = 279.5

üéØ **–û—Ç–≤–µ—Ç 2:** –ó–≤–µ–∑–¥–∞ 5 M‚òâ –∏–º–µ–µ—Ç —Å–≤–µ—Ç–∏–º–æ—Å—Ç—å **~280 L‚òâ**

---

üìù **–£—Å–ª–æ–≤–∏–µ 3:** –ù–∞–π–¥–∏—Ç–µ —Ä–∞–¥–∏—É—Å –°–∏—Ä–∏—É—Å–∞ –≤ –º–µ—Ç—Ä–∞—Ö.

üìù **–†–µ—à–µ–Ω–∏–µ:**
R_–°–∏—Ä–∏—É—Å = 1.71 √ó R‚òâ = 1.71 √ó 6.957√ó10‚Å∏ –º
R_–°–∏—Ä–∏—É—Å ‚âà 1.189√ó10‚Åπ –º

üéØ **–û—Ç–≤–µ—Ç 3:** –†–∞–¥–∏—É—Å –°–∏—Ä–∏—É—Å **~1.19 –º–ª–Ω –∫–º**

---

üìä **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –°–∏—Ä–∏—É—Å–∞:**
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 8.6 —Å–≤. –ª–µ—Ç (2.64 –ø–∫)
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 9940 K (–°–æ–ª–Ω—Ü–µ: 5772 K)
- –°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å: A1V (–±–µ–ª–∞—è –∑–≤–µ–∑–¥–∞)
- –í–æ–∑—Ä–∞—Å—Ç: ~200-300 –º–ª–Ω –ª–µ—Ç

‚ö° **–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:** –°–∏—Ä–∏—É—Å - –¥–≤–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: —è—Ä–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç A –∏ –±–µ–ª—ã–π –∫–∞—Ä–ª–∏–∫ B!
"""
    }

    if task_type in tasks:
        response = tasks[task_type]
        response += "\n\nüîç *–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Å–≤–æ–∏—Ö –∑–∞–¥–∞—á!*"
    else:
        response = "üìù –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞—á–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ"

    # –¢–û–õ–¨–ö–û –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º" - –±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"
    keyboard = [
        [InlineKeyboardButton("üîô –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º", callback_data="back_tasks")]
    ]

    reply_markup = InlineKeyboardMarkup(keyboard)

    await query.edit_message_text(response, parse_mode='Markdown', reply_markup=reply_markup)


# ==================== –†–ê–°–ß–ï–¢ –ü–õ–û–¢–ù–û–°–¢–ò ====================
async def calculate_density_from_text(update: Update, context: ContextTypes.DEFAULT_TYPE, text: str):
    """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    try:
        # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
        text = text.lower()
        if "–º–∞—Å—Å–∞=" in text and "—Ä–∞–¥–∏—É—Å=" in text:
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –º–∞—Å—Å—É
            mass_start = text.find("–º–∞—Å—Å–∞=") + 6
            mass_end = text.find(" ", mass_start)
            if mass_end == -1:
                mass_end = len(text)

            mass_str = text[mass_start:mass_end].replace(",", ".")

            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä–∞–¥–∏—É—Å
            radius_start = text.find("—Ä–∞–¥–∏—É—Å=") + 7
            radius_end = text.find(" ", radius_start)
            if radius_end == -1:
                radius_end = len(text)

            radius_str = text[radius_start:radius_end].replace(",", ".")

            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–∞
            mass = float(mass_str)
            radius = float(radius_str)

            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
            volume = (4 / 3) * 3.1415926535 * (radius ** 3)
            density_kg_m3 = mass / volume
            density_g_cm3 = density_kg_m3 / 1000

            response = f"""
üìè *–†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–°–ß–ï–¢–ê –ü–õ–û–¢–ù–û–°–¢–ò*

*–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:*
‚Ä¢ –ú–∞—Å—Å–∞: {mass:.3e} –∫–≥
‚Ä¢ –†–∞–¥–∏—É—Å: {radius:.3e} –º

*üìê –†–∞—Å—á–µ—Ç:*
1. –û–±—ä–µ–º: V = (4/3)œÄR¬≥ = {volume:.3e} –º¬≥
2. –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: œÅ = M/V = {mass:.3e} / {volume:.3e}

*üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:*
‚Ä¢ –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: {density_kg_m3:.2f} –∫–≥/–º¬≥
‚Ä¢ –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: {density_g_cm3:.3f} –≥/—Å–º¬≥

*üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:*
‚Ä¢ –í–æ–¥–∞: 1000 –∫–≥/–º¬≥ (1.00 –≥/—Å–º¬≥)
‚Ä¢ –ó–µ–º–ª—è: 5515 –∫–≥/–º¬≥ (5.52 –≥/—Å–º¬≥)
‚Ä¢ –°–≤–∏–Ω–µ—Ü: 11340 –∫–≥/–º¬≥ (11.34 –≥/—Å–º¬≥)
"""

            await update.message.reply_text(response, parse_mode='Markdown')

        else:
            await update.message.reply_text(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\n"
                "`–ø–ª–æ—Ç–Ω–æ—Å—Ç—å: –º–∞—Å—Å–∞=5.9722e24 —Ä–∞–¥–∏—É—Å=6.371e6`\n\n"
                "–ü—Ä–∏–º–µ—Ä—ã:\n"
                "‚Ä¢ –î–ª—è –ó–µ–º–ª–∏: `–ø–ª–æ—Ç–Ω–æ—Å—Ç—å: –º–∞—Å—Å–∞=5.9722e24 —Ä–∞–¥–∏—É—Å=6.371e6`\n"
                "‚Ä¢ –î–ª—è –ú–∞—Ä—Å–∞: `–ø–ª–æ—Ç–Ω–æ—Å—Ç—å: –º–∞—Å—Å–∞=6.4171e23 —Ä–∞–¥–∏—É—Å=3.3895e6`\n"
                "‚Ä¢ –î–ª—è –°–æ–ª–Ω—Ü–∞: `–ø–ª–æ—Ç–Ω–æ—Å—Ç—å: –º–∞—Å—Å–∞=1.9885e30 —Ä–∞–¥–∏—É—Å=6.957e8`",
                parse_mode='Markdown'
            )

    except ValueError as e:
        await update.message.reply_text(
            "‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —á–∏—Å–µ–ª. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—É—á–Ω—É—é –Ω–æ—Ç–∞—Ü–∏—é:\n"
            "–ù–∞–ø—Ä–∏–º–µ—Ä: 5.9722e24 –∏–ª–∏ 6.371e6",
            parse_mode='Markdown'
        )
    except Exception as e:
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞: {str(e)}\n"
            "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö!",
            parse_mode='Markdown'
        )


# ==================== –û–ë–†–ê–ó–û–í–ê–¢–ï–õ–¨–ù–´–ï –ú–û–î–£–õ–ò ====================
async def show_methods(update: Update):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç–æ–¥—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π"""
    methods = """
üî¨ *–ú–ï–¢–û–î–´ –ê–°–¢–†–û–ù–û–ú–ò–ß–ï–°–ö–ò–• –ò–ó–ú–ï–†–ï–ù–ò–ô*

*üì° –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å—ã:*
‚Ä¢ –ü–ª–∞–Ω–µ—Ç—ã: –ø–æ –¥–≤–∏–∂–µ–Ω–∏—é —Å–ø—É—Ç–Ω–∏–∫–æ–≤ (—Ñ–æ—Ä–º—É–ª–∞: M = 4œÄ¬≤a¬≥/(GT¬≤))
‚Ä¢ –ó–≤–µ–∑–¥—ã –≤ –¥–≤–æ–π–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö: —Ç—Ä–µ—Ç–∏–π –∑–∞–∫–æ–Ω –ö–µ–ø–ª–µ—Ä–∞
‚Ä¢ –û–¥–∏–Ω–æ—á–Ω—ã–µ –∑–≤–µ–∑–¥—ã: —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ + —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å

*üìè –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞:*
‚Ä¢ –†–∞–¥–∏–æ–ª–æ–∫–∞—Ü–∏—è (–ø–ª–∞–Ω–µ—Ç—ã): œÑ = 2R/c
‚Ä¢ –ò–Ω—Ç–µ—Ä—Ñ–µ—Ä–æ–º–µ—Ç—Ä–∏—è (–∑–≤–µ–∑–¥—ã): Œ∏ = 1.22Œª/D
‚Ä¢ –ó–∞—Ç–º–µ–Ω–Ω—ã–µ –¥–≤–æ–π–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: –ø–æ –∫—Ä–∏–≤–æ–π –±–ª–µ—Å–∫–∞
‚Ä¢ –£–≥–ª–æ–≤–æ–π –¥–∏–∞–º–µ—Ç—Ä + –ø–∞—Ä–∞–ª–ª–∞–∫—Å: R = Œ∏¬∑d/2

*‚òÄÔ∏è –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–∏–º–æ—Å—Ç–∏:*
‚Ä¢ –§–æ—Ç–æ–º–µ—Ç—Ä–∏—è + –ø–∞—Ä–∞–ª–ª–∞–∫—Å: L = 4œÄd¬≤F
‚Ä¢ –ë–æ–ª–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è: –∏–Ω—Ç–µ–≥—Ä–∞–ª –ø–æ –≤—Å–µ–º—É —Å–ø–µ–∫—Ç—Ä—É
‚Ä¢ –ú–æ–¥–µ–ª–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä –∑–≤–µ–∑–¥: –∑–∞–∫–æ–Ω –°—Ç–µ—Ñ–∞–Ω–∞-–ë–æ–ª—å—Ü–º–∞–º–∞ L = 4œÄR¬≤œÉT‚Å¥

*üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è:*
‚Ä¢ –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–ª–ª–∞–∫—Å: d = 1/p (–ø–∫)
‚Ä¢ –°–ø–µ–∫—Ç—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–ª–ª–∞–∫—Å: –ø–æ —Å–ø–µ–∫—Ç—Ä—É –∏ —Å–≤–µ—Ç–∏–º–æ—Å—Ç–∏
‚Ä¢ –¶–µ—Ñ–µ–∏–¥—ã: –ø–µ—Ä–∏–æ–¥-—Å–≤–µ—Ç–∏–º–æ—Å—Ç—å P-L relation
‚Ä¢ –ö—Ä–∞—Å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ: –∑–∞–∫–æ–Ω –•–∞–±–±–ª–∞ v = H‚ÇÄd

*üéØ –¢–æ—á–Ω–æ—Å—Ç—å –≤ –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö:*
1. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å!
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –°–ò
3. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
4. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ –º–µ—Ç–æ–¥ –∏–∑–º–µ—Ä–µ–Ω–∏—è
"""
    await update.message.reply_text(methods, parse_mode='Markdown', reply_markup=get_main_keyboard())


async def show_help(update: Update):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–º–æ—â—å"""
    help_text = """
‚ùì *–ü–û–ú–û–©–¨ –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ ASTROBOT*

*–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ ü™ê **8 –ü–ª–∞–Ω–µ—Ç** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–µ—Ç–∞—Ö –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ ‚≠êÔ∏è **–°–∏—Ä–∏—É—Å** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Å–∞–º–æ–π —è—Ä–∫–æ–π –∑–≤–µ–∑–¥–µ
‚Ä¢ ‚òÄÔ∏è **–°–æ–ª–Ω—Ü–µ** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—à–µ–π –∑–≤–µ–∑–¥—ã
‚Ä¢ üìä **–°—Ä–∞–≤–Ω–∏—Ç—å** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –Ω–µ–±–µ—Å–Ω—ã—Ö —Ç–µ–ª
‚Ä¢ üìù **–ó–∞–¥–∞—á–∏** - –æ–ª–∏–º–ø–∏–∞–¥–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å –ø–æ–ª–Ω—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏
‚Ä¢ üî¨ **–ú–µ—Ç–æ–¥—ã** - –º–µ—Ç–æ–¥–∏–∫–∏ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π

*üìè –†–∞—Å—á–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏:*
–î–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:
`–ø–ª–æ—Ç–Ω–æ—Å—Ç—å: –º–∞—Å—Å–∞=5.9722e24 —Ä–∞–¥–∏—É—Å=6.371e6`

*üéØ –î–ª—è –æ–ª–∏–º–ø–∏–∞–¥:*
‚Ä¢ –í—Å–µ –∑–∞–¥–∞—á–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
‚Ä¢ –£–∫–∞–∑–∞–Ω—ã –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–æ—Ä–º—É–ª—ã
‚Ä¢ –î–∞–Ω—ã —á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç
‚Ä¢ –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã

*üìö –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤:*
‚Ä¢ G = 6.67430√ó10‚Åª¬π¬π –º¬≥/(–∫–≥¬∑—Å¬≤) (–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è)
‚Ä¢ œÉ = 5.670374√ó10‚Åª‚Å∏ –í—Ç/(–º¬≤¬∑–ö‚Å¥) (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –°—Ç–µ—Ñ–∞–Ω–∞-–ë–æ–ª—å—Ü–º–∞–Ω–∞)
‚Ä¢ 1 –∞.–µ. = 149 597 870 700 –º (–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –µ–¥–∏–Ω–∏—Ü–∞)
‚Ä¢ 1 –ø–∫ = 3.085677581√ó10¬π‚Å∂ –º = 3.261563776 —Å–≤. –ª–µ—Ç (–ø–∞—Ä—Å–µ–∫)
‚Ä¢ M‚òâ = 1.9885√ó10¬≥‚Å∞ –∫–≥ (–º–∞—Å—Å–∞ –°–æ–ª–Ω—Ü–∞)
‚Ä¢ R‚òâ = 6.957√ó10‚Å∏ –º (—Ä–∞–¥–∏—É—Å –°–æ–ª–Ω—Ü–∞)
‚Ä¢ L‚òâ = 3.828√ó10¬≤‚Å∂ –í—Ç (—Å–≤–µ—Ç–∏–º–æ—Å—Ç—å –°–æ–ª–Ω—Ü–∞)

*‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:*
‚Ä¢ –ö –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ
‚Ä¢ –ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —à–∞–≥–∏ —Ä–∞—Å—á–µ—Ç–∞
‚Ä¢ –î–∞–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã
‚Ä¢ –§–æ—Ä–º—É–ª—ã —É–∫–∞–∑–∞–Ω—ã –≤ —Ä–µ—à–µ–Ω–∏—è—Ö –∑–∞–¥–∞—á
"""
    await update.message.reply_text(help_text, parse_mode='Markdown', reply_markup=get_main_keyboard())


async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏"""
    query = update.callback_query
    await query.answer()

    data = query.data
    print(f"üîò –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞: {data}")  # –î–õ–Ø –û–¢–õ–ê–î–ö–ò

    if data.startswith("body_"):
        body_name = data.split("_")[1]
        await show_celestial_body_inline(query, body_name)

    elif data.startswith("compare_"):
        bodies = data.split("_")[1:]
        if len(bodies) == 2:
            await show_comparison(query, bodies[0], bodies[1])

    elif data.startswith("task_"):
        task_type = data.split("_")[1]
        print(f"üìù –í—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ —Ç–∏–ø–∞: {task_type}")  # –î–õ–Ø –û–¢–õ–ê–î–ö–ò
        await show_task_with_solution(query, task_type)

    elif data == "back_main":
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º edit_message_text –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        await query.edit_message_text(
            "üè† *–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é*\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –∫–Ω–æ–ø–æ–∫ –Ω–∏–∂–µ:",
            parse_mode='Markdown'
        )
        await query.edit_message_reply_markup(None)
        # –ò –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ù–û–í–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≥–ª–∞–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
        await query.message.reply_text("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=get_main_keyboard())

    elif data == "back_planets":
        await query.edit_message_text(
            "üåå *–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω–µ—Ç—É:*\n(8 –ø–ª–∞–Ω–µ—Ç –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã)",
            parse_mode='Markdown',
            reply_markup=get_planets_keyboard()
        )

    elif data == "back_compare":
        await query.edit_message_text(
            "‚öñÔ∏è *–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:*",
            parse_mode='Markdown',
            reply_markup=get_compare_keyboard()
        )

    elif data == "back_tasks":
        await query.edit_message_text(
            "üìö *–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞—á–∏:*",
            parse_mode='Markdown',
            reply_markup=get_tasks_keyboard()
        )


# ==================== –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ====================
def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    print("=" * 60)
    print("üöÄ AstroBot: –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏–∏ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏")
    print(f"üìÅ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSON –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {len(CELESTIAL_DATA)} –æ–±—ä–µ–∫—Ç–æ–≤")
    print("=" * 60)

    if not CELESTIAL_DATA:
        print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª celestial_data.json –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ")
        return

    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(CELESTIAL_DATA)} –Ω–µ–±–µ—Å–Ω—ã—Ö —Ç–µ–ª")
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    planets = sum(1 for obj in CELESTIAL_DATA.values() if '–ø–ª–∞–Ω–µ—Ç–∞' in obj.get('type', '').lower())
    stars = sum(1 for obj in CELESTIAL_DATA.values() if '–∑–≤–µ–∑–¥–∞' in obj.get('type', '').lower())

    print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {planets} –ø–ª–∞–Ω–µ—Ç, {stars} –∑–≤–µ–∑–¥")
    print("=" * 60)

    # –ó–∞–ø—É—Å–∫ keep-alive –≤ —Ñ–æ–Ω–µ
    keep_alive_thread = threading.Thread(target=keep_alive, daemon=True)
    keep_alive_thread.start()
    print("‚úÖ Keep-alive –ø–æ—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ")

    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω, –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–π –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
        application = Application.builder().token(TOKEN).build()

        # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        application.add_handler(CommandHandler("start", start_command))
        application.add_handler(CallbackQueryHandler(button_callback))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

        print("–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
        print("1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram")
        print("2. –ù–∞–ø–∏—à–∏—Ç–µ /start")
        print("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏")
        print("=" * 60)

        application.run_polling(allowed_updates=Update.ALL_TYPES)

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        print("=" * 60)


if __name__ == '__main__':
    main()
